-#
-# ish_manager / maps / show.haml
-#

.maps-show
  = render 'map_meta_row', map: @map
  %p.addToggle Description
  .descr= raw @map.description

  %p.addToggle
    The Map (#{@map.w}x#{@map.h})
    = link_to 'Map Editor', location_map_editor_path(@map.id)
  .the-map
    = image_tag @map.image.image.url(:original) rescue nil
    - @markers.each do |marker|
      -# @TODO: this should be a partial
      .marker{ style: "position: absolute; left: #{marker.x - marker.centerOffsetX}px; top: #{marker.y - marker.centerOffsetY}px;" }
        - if marker.image
          = image_tag marker.image.image.url(:original)
        - else
          = image_missing_tag

  = render 'ish_manager/markers/header', markers: @markers, map: @map
  = render 'ish_manager/markers/index', markers: @markers, map: @map

  %p.addToggle= render 'ish_manager/newsitems/header', newsitems: @map.newsitems
  = render 'ish_manager/newsitems/index', newsitems: @map.newsitems

  %p.addToggle Maps (#{@maps.count})
  .maps-list
    - @maps.each do |m|
      .item
        = link_to m.slug, edit_map_path(m.id)

%hr
= render 'form'

= button_to 'Export Subtree', export_map_path(@map.id, format: :json)

= render 'index_item', map: @map


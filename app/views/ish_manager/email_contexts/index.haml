
.email-contexts-index.padded

  .header.collapse-expand-trash#emailContextsIndex
    %h2.title
      Email Contexts (#{@ctxs.length})
      - if @lead
        For lead `#{@lead.name}`
      = link_to '[+]', new_email_context_path
      = link_to '[unsent]', notsent_email_contexts_path

  .W0
    = render 'paginate', resource: @ctxs, param_name: :email_contexts_page, views_prefix: :ish_manager

    %table.bordered.data-table
      %thead
        %tr
          %th.actions
          %th.from From
          %th.to To
          %th.subject Subject
          %th.template Template
          %th.created_at Created at
          %th.updated_at Updated at
      %tbody
        - @ctxs.each do |ctx|
          %tr
            %td
              - if ctx.sent_at
                [~]
              - else
                = link_to '[~]', edit_email_context_path(ctx)
              = button_to '[x]', email_context_path(ctx), method: :delete, form_class: :inline, data: { confirm: 'Are you sure?' }
            %td
              = ctx.from_email ? ctx.from_email : "t| #{ctx.tmpl.from_email}"
            %td= ctx.to_email
            %td
              = link_to email_context_path(ctx) do
                = ctx.subject ? ctx.subject : "t| #{ctx.tmpl.subject}"
            %td= ctx.email_template.slug
            %td= ctx.created_at.strftime('%Y-%m-%d %l:%M%P %:z')
            %td= ctx.updated_at.strftime('%Y-%m-%d %l:%M%P %:z')


    = render 'paginate', resource: @ctxs, param_name: :email_contexts_page, views_prefix: :ish_manager
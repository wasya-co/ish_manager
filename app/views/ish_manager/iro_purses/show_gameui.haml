
.iro-purses-show-gameui.padded
  .max-width
    .header
      %h4.title
        GAMEUI::Purse ##{@purse.id}.
        #{link_to '[~]', edit_iro_purse_path(@purse)}
        Value: $#{@purse.current_value}

  %h5.collapse-expand#iroPurseConfig
    Config
  .config
    = render 'form', iro_purse: @purse
  .c

  %h5.collapse-expand#strategies
    Strategies (#{@strategies.length})
    = link_to '[+]', new_iro_strategy_path({ iro_purse_id: @purse.id })
  .strategies.items
    - @strategies.each do |strat|
      .strategy.item= render 'ish_manager/iro_strategies/form', strategy: strat
  .c

  %h5.collapse-expand#gameuiPositions
    Gameui Positions (#{@positions.length})
    = link_to '[+]', new_iro_position_path({ iro_purse_id: @purse.id })
  .gameui-positions
    - @positions.each do |p|

      -# something like, $23 Apr-14
      .gameuiW.show-amounts{ data: { cc: { strike: p.strike, startPrice: p.opened_price, currentPrice: p.current_price, cus: p.strategy.current_underlying_strike } } }
        .gameui
          .gameuiC
            = link_to '[roll]', roll_iro_position_path(p)

            .elephantW
              .elephant
                .elephantC

                  .amount

                  .q= p.quantity

                  .riderW
                    .rider
                      .riderC

                  .riderStart
                    .amount
                    .riderCurrent
                      .amount

                  .riderStart2
                    .amount
                    .riderCurrent2
                      .amount


                .sunflowerW
                  .sunflower
                    .sunflowerC

                      .days-left= (p.expires_on.to_date - Time.now.to_date).to_i

            .windW
              .wind
                .c-u-s= pp_currency p.strategy.current_underlying_strike
                .windC


            .spearW
              .spear
                .spearC
                  .spearStart
                    .spearCurrent
  .c

  %h5.collapse-expand#spreadsheetPositions
    Positions (#{@positions.length})
    = link_to '[+]', new_iro_position_path({ iro_purse_id: @purse.id })
  .positions
    %table.bordered
      %thead
        %tr
          %td
            .id id
          %td
            .strategy Strategy
          %td
            .ticker Ticker
          %td
            .type Kind/Type
          %td
            .strike Strike
          %td
            .expires_on ExpiresOn
          %td
            .days-left Days Left
          %td
            .q Q
          %td
            .begin-on Begin On
          %td
            .price Begin Price
          %td
            .to-open To Open
          %td
            .begin-delta #{"\u0394"}
          %td
            .to-close Current $ <br />(To Close)
          %td
            .net Net
          %td
            .netp % Net
          %td
            .delta #{"\u0394"}
          %td
            .days-at-open Days@Open
          %td
            .must-roll Must roll?
          %td
            .should-roll Should roll?
          %td
            .next-symbol Next Symbol
          %td
            .next-delta Next Delta
          %td
            .next-outcome Next Outcome
          %td
            .state State
      %tbody
        - @positions.each do |p|
          %tr
            %td.id
              = p.id
              = link_to '[~]', edit_iro_position_path(p)
            %td.strategy= link_to p.strategy, edit_iro_strategy_path(p.strategy)
            %td= p.ticker
            %td= p.type == "Iro::CoveredCall" ? "CALL" : "other"
            %td= p.strike
            %td= p.expires_on.strftime('%b %d')
            %td.days-left= (p.expires_on.to_date - Time.now.to_date).to_i
            %td.q= p.quantity
            %td.begin-on= pp_date p.opened_on
            %td.price= pp_amount p.opened_price
            %td.to-open
              -# = pp_amount( p.opened_price * p.quantity )
            %td.begin-delta= sprintf('%.2f', p.opened_delta ) rescue nil
            %td= pp_money p.current_price
            %td.net
              = pp_money ( p.opened_price - p.current_price ) - 0.013
            %td.netp
              = pp_percent ( p.opened_price - p.current_price ) / p.opened_price
            %td= sprintf('%.2f', p.current_delta ) rescue nil
            %td= (p.expires_on.to_date - p.opened_on).to_i
            %td.must-roll= pp_bool p.must_roll?
            %td.should-roll
              .aC
                .a= p.should_rollp ? p.should_rollp : '-'
                .a= pp_bool p.should_roll?
            %td.next-symbol= p.next_symbol
            %td.next-delta= p.next_position[:delta]
            %td.next-outcome= pp_money p.next_outcome
            %td.state= p.status
  .c

